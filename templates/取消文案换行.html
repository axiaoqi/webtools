{% extends 'base.html' %}

{% block title %}去除换行符工具{% endblock %}

{% block content %}
<div class="container my-5">
    <div class="row justify-content-center">
        <div class="col-md-8 col-lg-7 text-center">

            <!-- 1. 标题和描述 -->
            <h1 class="h2 mb-3">去除换行符</h1>
            <p class="text-muted mb-4">
                将文本粘贴到下方，点击按钮即可去除所有换行并复制结果。
            </p>

            <!-- 2. 使用带 placeholder 的标准文本输入域 -->
            <div class="mb-3">
                <textarea class="form-control"
                          id="inputText"
                          rows="12"
                          placeholder="在此处输入或粘贴文本..."
                          autofocus></textarea>
            </div>

            <!-- 3. 操作按钮 -->
            <div class="d-grid gap-2 col-8 mx-auto">
                <button id="copyButton" class="btn btn-primary btn-lg">
                    <i class="bi bi-clipboard-check-fill me-2"></i> 去除换行并复制
                </button>
            </div>

            <!-- 4. 状态消息提示区 -->
            <div id="statusMessage" class="mt-3 small fw-bold" style="min-height: 1.5rem;"></div>

        </div>
    </div>
</div>
{% endblock %}


{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', (event) => {
        // 获取页面元素
        const textArea = document.getElementById('inputText');
        const copyButton = document.getElementById('copyButton');
        const statusMessage = document.getElementById('statusMessage');

        // 为按钮添加点击事件监听
        copyButton.addEventListener('click', () => {
            const originalText = textArea.value;

            // 检查输入是否为空
            if (!originalText.trim()) {
                showStatus('输入框为空或只有空白字符。', 'danger');
                return;
            }

            // 使用正则表达式去除所有类型的换行符
            const textWithoutNewlines = originalText.replace(/(\r\n|\n|\r)/gm, "");

            // 检查处理后是否为空 (例如，用户只输入了换行符)
            if (!textWithoutNewlines) {
                showStatus('处理后的文本为空（可能只有换行符）。', 'danger');
                return;
            }

            // 优先使用现代、安全的 Clipboard API 进行复制
            if (navigator.clipboard && window.isSecureContext) {
                navigator.clipboard.writeText(textWithoutNewlines).then(() => {
                    showStatus('已成功复制到剪贴板！', 'success');
                }).catch(err => {
                    console.error('使用 Clipboard API 复制失败: ', err);
                    showStatus('复制失败！请尝试手动复制。', 'danger');
                    fallbackCopy(textWithoutNewlines); // 失败时尝试备用方法
                });
            } else {
                // 如果 Clipboard API 不可用（例如在非 HTTPS 网站上）
                console.warn('Clipboard API 不可用，尝试使用旧方法。');
                fallbackCopy(textWithoutNewlines);
            }
        });

        // 统一的状态消息显示函数
        function showStatus(message, type = 'success') {
            // 根据类型设置 Bootstrap 的文本颜色类 (text-success, text-danger)
            statusMessage.className = `mt-3 small fw-bold text-${type}`;
            statusMessage.textContent = message;

            // 3秒后自动清除消息
            setTimeout(() => {
                statusMessage.textContent = '';
                statusMessage.className = 'mt-3 small fw-bold';
            }, 3000);
        }

        // 备用的复制方法，兼容性更好
        function fallbackCopy(text) {
            const tempTextArea = document.createElement("textarea");
            tempTextArea.value = text;
            tempTextArea.style.position = 'fixed';
            tempTextArea.style.top = '-9999px'; // 移出视窗外
            document.body.appendChild(tempTextArea);
            tempTextArea.focus();
            tempTextArea.select();

            try {
                const successful = document.execCommand('copy');
                if (successful) {
                    showStatus('已通过备用方法复制！', 'success');
                } else {
                    showStatus('备用复制方法也失败了，请手动复制。', 'danger');
                }
            } catch (err) {
                console.error('使用 document.execCommand 复制失败: ', err);
                showStatus('复制出错了，请手动复制。', 'danger');
            }

            document.body.removeChild(tempTextArea);
        }
    });
</script>
{% endblock %}